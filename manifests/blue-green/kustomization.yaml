apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: hello-world-ns
resources:
  - hello-world-ns.yaml
  - hello-world-deployment-blue.yaml
  - hello-world-deployment-green.yaml
  - hello-world-service.yaml
  - hello-world-networkpolicy.yaml

# Common annotations (labels removed to avoid selector immutability issues)
commonAnnotations:
  documentation: See docs/blue-green-deployment.md
  app.kubernetes.io/managed-by: kustomize
  deployment-strategy: blue-green

# No global image transformer - each deployment has its own version
# Blue: 1.3.2 (stable), Green: 1.4.0 (new version)
# Update the deployment YAML files directly to change versions

# Replicas can be overridden per environment
# For blue deployment
replicas:
  - name: hello-world-blue
    count: 3
  - name: hello-world-green
    count: 3

# Example: Add ConfigMap for application config
# configMapGenerator:
#   - name: app-config
#     literals:
#       - DEPLOYMENT_STRATEGY=blue-green
#       - ENVIRONMENT=production
